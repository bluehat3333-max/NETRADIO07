# NETRADIO07 User Station Manager

## 概要
ESP32ベースのインターネットラジオで、各ユーザーが自分専用のラジオ局リストを管理できるシステムです。SSD1306 OLEDディスプレイとWiFiManagerを使用したバージョンです。

## 主な機能

### 1. ユーザー独自の局管理
- Webインターフェースで簡単に局の追加・削除
- リアルタイムでの局リストの編集
- SPIFFSを使用した設定の永続化

### 2. 操作方法
- **短押し**: 音量モード⇔局選択モードの切り替え
- **長押し(2秒)**: スリープモード
- **超長押し(5秒)**: 設定モード（Webインターフェース起動）

### 3. 視覚的フィードバック
- NeoPixelでステータス表示（緑=正常、青=設定モード、赤=スリープ/エラー）
- SSD1306 OLEDでリアルタイム情報表示
- WiFi信号強度の視覚的表示

### 4. WiFi管理
- WiFiManager使用で簡単なWiFi設定
- 自動接続機能
- 設定ポータルによる再設定

## 必要なライブラリ

以下のライブラリをArduino IDEのライブラリマネージャーからインストールしてください：

1. **ESP32-audioI2S** by schreibfaul1
   - インターネットラジオストリーミング用

2. **Adafruit GFX Library** by Adafruit
   - グラフィックライブラリ

3. **Adafruit SSD1306** by Adafruit
   - OLEDディスプレイ制御用

4. **RotaryEncoder** by Matthias Hertel
   - ロータリーエンコーダー制御用

5. **ArduinoJson** by Benoit Blanchon
   - JSON処理用（設定ファイルの読み書き）

6. **WiFiManager** by tzapu
   - WiFi設定管理用

7. **Adafruit NeoPixel** by Adafruit
   - NeoPixel LED制御用

## 必要なハードウェア

- ESP32開発ボード (ESP32-S3推奨、内蔵NeoPixel付き)
- MAX98357A I2S DAC アンプモジュール
- SSD1306 OLED ディスプレイ (128x64)
- ロータリーエンコーダー（プッシュスイッチ付き）
- スピーカー

## 配線

### I2S DAC (MAX98357A)
- BCLK → GPIO16
- LRC → GPIO17  
- DIN → GPIO15
- VDD → 3.3V
- GND → GND

### OLED Display (SSD1306)
- SCL → GPIO5
- SDA → GPIO4
- VCC → 3.3V
- GND → GND

### ロータリーエンコーダー
- CLK → GPIO6
- DT → GPIO18
- SW → GPIO7
- VCC → 3.3V
- GND → GND

### NeoPixel LED
- 内蔵 → GPIO48（ESP32-S3の場合）

## セットアップ手順

1. 必要なライブラリをインストール
2. ハードウェアを配線
3. WiFi設定：
   - 初回起動時、"NETRADIO07-Setup"アクセスポイントに接続
   - ブラウザで設定画面を開きWiFi情報を入力
   - または自動的に既存のWiFi設定を使用

4. ラジオ局設定：
   - 5秒間ボタン長押しで設定モード開始
   - NeoPixelが青色に点灯
   - ブラウザでESP32のIPアドレスにアクセス
   - Webインターフェースでラジオ局を追加

## 使用方法

### 基本操作
1. 電源オン後、自動的に最後に聞いていた局を再生
2. ロータリーエンコーダーを回して音量調整
3. ボタン短押しで局選択モードに切り替え（NeoPixelが黄色に点滅）
4. 局選択モードでエンコーダーを回して局変更

### ステータス表示（NeoPixel）
- **緑色**: 正常動作中
- **青色**: 設定モード
- **赤色**: スリープ/エラー状態
- **黄色点滅**: モード切替時
- **オレンジ**: ラジオ局未設定

### ディスプレイ情報
- 現在の動作モード
- 音量レベル / 局番号
- 局名（長い場合は自動スクロール）
- WiFi信号強度
- 操作ガイド

### 設定モード
1. ボタンを5秒間長押し
2. NeoPixelが青色に点灯
3. OLEDにIPアドレスが表示される
4. スマートフォンやPCのブラウザでそのIPにアクセス
5. Webインターフェースで局の追加・削除・管理
6. ボタンを押して設定モード終了（NeoPixelが緑色に戻る）

## 特徴

### 利点
- **簡単WiFi設定**: WiFiManagerで設定ポータル使用
- **視覚的フィードバック**: NeoPixelとOLEDでステータス確認
- **個人カスタマイズ**: 各ユーザーが好みの局だけを管理
- **自動復帰**: 電源投入時に前回の設定を復元
- **省電力**: ディープスリープモード対応

### 技術的特徴
- タスクベースの並列処理
- 音声コマンドキュー使用
- SPIFFS使用でFlashメモリに設定保存
- WebサーバーとI2Sの同時動作
- ハードウェア状態の視覚的表示

## トラブルシューティング

### WiFi接続できない
- "NETRADIO07-Setup"アクセスポイントに接続して再設定
- WiFiManagerリセット機能を使用

### NeoPixelが点灯しない
- GPIO48の配線を確認（ESP32-S3の場合）
- 電源供給を確認

### 音が出ない
- I2S配線を確認
- スピーカーの接続を確認
- 音量設定を確認

### 設定モードに入れない
- 5秒間しっかりとボタンを押し続ける
- NeoPixelの色変化を確認

## ファイル構成

- `NETRADIO07_UserManaged.ino` - メインプログラム
- `user_station_manager_ssd1306.h` - ユーザー局管理ヘッダー
- `user_station_manager_ssd1306.cpp` - ユーザー局管理実装
- `/data/user_stations.json` - ユーザー設定ファイル（自動生成）

## バージョン間の違い

| 機能 | NETRADIO07 | NETRADIO055 |
|------|------------|-------------|
| ディスプレイ | SSD1306 (Adafruit) | SSD1306 (U8g2) |
| WiFi管理 | WiFiManager | SmartConfig |
| LED表示 | NeoPixel | なし |
| 音声処理 | キューベース | 直接処理 |

## 今後の拡張案

- [ ] Bluetoothスピーカー対応
- [ ] アラーム機能
- [ ] プレイリスト機能  
- [ ] リモートコントロール
- [ ] 音質イコライザー
- [ ] 複数ユーザープロファイル