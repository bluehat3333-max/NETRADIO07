# NETRADIO User Station Manager

## 概要
ESP32ベースのインターネットラジオで、各ユーザーが自分専用のラジオ局リストを管理できるシステムです。

## 主な機能

### 1. ユーザー独自の局管理
- Webインターフェースで簡単に局の追加・削除
- リアルタイムでの局リストの編集
- SPIFFSを使用した設定の永続化

### 2. 操作方法
- **短押し**: 音量モード⇔局選択モードの切り替え
- **長押し(2秒)**: スリープモード
- **超長押し(5秒)**: 設定モード（Webインターフェース起動）

### 3. Web設定インターフェース
- 直感的な操作でラジオ局を管理
- URLからの一括インポート機能
- JSON形式でのエクスポート/インポート
- ストリームのリアルタイムテスト機能

## 必要なライブラリ

以下のライブラリをArduino IDEのライブラリマネージャーからインストールしてください：

1. **ESP32-audioI2S** by schreibfaul1
   - インターネットラジオストリーミング用

2. **U8g2** by oliver
   - OLEDディスプレイ制御用

3. **RotaryEncoder** by Matthias Hertel
   - ロータリーエンコーダー制御用

4. **ArduinoJson** by Benoit Blanchon
   - JSON処理用（設定ファイルの読み書き）

## 必要なハードウェア

- ESP32開発ボード (ESP32-S3推奨)
- MAX98357A I2S DAC アンプモジュール
- SSD1306 OLED ディスプレイ (128x64)
- ロータリーエンコーダー（プッシュスイッチ付き）
- スピーカー

## 配線

### I2S DAC (MAX98357A)
- BCLK → GPIO1
- LRC → GPIO2  
- DIN → GPIO3
- VDD → 3.3V
- GND → GND

### OLED Display (SSD1306)
- SCL → GPIO6
- SDA → GPIO5
- VCC → 3.3V
- GND → GND

### ロータリーエンコーダー
- CLK → GPIO8
- DT → GPIO9
- SW → GPIO7
- VCC → 3.3V
- GND → GND

## セットアップ手順

1. 必要なライブラリをインストール
2. ハードウェアを配線
3. WiFi設定：
   - 初回起動時にロータリーエンコーダーのボタンを押しながら電源オン
   - SmartConfigモードでWiFi設定
   - または、コード内でWiFi認証情報を直接設定

4. ラジオ局設定：
   - 5秒間ボタン長押しで設定モード開始
   - ブラウザでESP32のIPアドレスにアクセス
   - Webインターフェースでラジオ局を追加

## 使用方法

### 基本操作
1. 電源オン後、自動的に最後に聞いていた局を再生
2. ロータリーエンコーダーを回して音量調整
3. ボタン短押しで局選択モードに切り替え
4. 局選択モードでエンコーダーを回して局変更

### 設定モード
1. ボタンを5秒間長押し
2. ディスプレイにIPアドレスが表示される
3. スマートフォンやPCのブラウザでそのIPにアクセス
4. Webインターフェースで局の追加・削除・管理
5. ボタンを押して設定モード終了

### 局の追加方法
- **個別追加**: 局名とストリームURLを入力
- **一括インポート**: CSV形式のファイルURLを指定
- **デフォルト復元**: 組み込みの局リストを読み込み

### ファイル形式（インポート用）
```
局名1,http://example.com/stream1.mp3
局名2,http://example.com/stream2.mp3
Jazz Station,http://ice1.somafm.com/groovesalad-128-mp3
```

## 特徴

### 利点
- **個人カスタマイズ**: 各ユーザーが好みの局だけを管理
- **簡単設定**: Webブラウザで直感的に操作
- **バックアップ**: JSON形式でエクスポート可能
- **共有**: 局リストを他のユーザーと共有可能
- **メモリ効率**: 不要な局を削除してメモリ節約

### 技術的特徴
- SPIFFS使用でFlashメモリに設定保存
- タスクベースの並列処理
- ハードウェアウォッチドッグで安定性確保
- 低電力スリープモード対応
- WebサーバーとI2Sの同時動作

## トラブルシューティング

### WiFi接続できない
- SmartConfigモードでの再設定を試す
- ルーターの2.4GHz帯を確認

### 音が出ない
- I2S配線を確認
- スピーカーの接続を確認
- 音量設定を確認

### 設定モードに入れない
- 5秒間しっかりとボタンを押し続ける
- シリアルモニターで動作確認

### 局が再生されない
- ストリームURLの有効性を確認
- ファイアウォール設定を確認
- インターネット接続を確認

## ファイル構成

- `NETRADIO055_UserManaged.ino` - メインプログラム
- `user_station_manager.h` - ユーザー局管理ヘッダー
- `user_station_manager.cpp` - ユーザー局管理実装
- `/data/user_stations.json` - ユーザー設定ファイル（自動生成）

## 今後の拡張案

- [ ] プレイリスト機能
- [ ] 自動局検索機能  
- [ ] スリープタイマー
- [ ] 音質設定
- [ ] 複数ユーザープロファイル
- [ ] クラウド同期機能